<html>
	<head>
		<meta charset="utf-8">
		<script src="http://code.jquery.com/jquery-1.11.3.min.js" ></script>
		<style type="text/css">
			table {
				border-spacing: 0px;
				border-collapse: collapse;
			}
			table td, th {
				vertical-align: top;
				text-align: left;
				border: 1px grey solid;
				border-collapse: collapse;
				padding: 5px;
			}
			h4 {
				margin: 10px 0px 0px 0px;
			}
			.gherkin {
				white-space: pre;
				font-family: monospace;
			}
			#gherkin-feature .label, #gherkin-scenario .label, #gherkin-step .label {
				color: #a71d5d;
			}
			#gherkin-feature .description, #gherkin-scenario .description {
				color: #183691;
			}
			.section {
				margin: 50px 0px 0px 0px;
			}
		</style>
	</head>
	<body>
		<h1>iBBB - Banana Best Bank Inc. application for account management</h1>
		<div id="contents" class="section">
			<h2>Table of contents</h2>
			<ol>
				<li>
					<a href="#vocabulary">Vocabulary</a>
				</li>
				<li>
					<a href="#introduction">Introduction</a>
				</li>
				<li>
					<a href="#functional-requirements">Functional requirements</a>
					<ol>
						<li>
								<a href="#generate-password">Generate the one time password.</a>
						</li>
						<li>
								<a href="#check-the-balance">Check the balance of the account</a>
						</li>
						<li>
								<a href="#check-the-transactions">Check the list of transactions</a>
						</li>
						<li>
								<a href="#increase-balance">Increase the balance of the account</a>
						</li>
						<li>
								<a href="#decrease-balance">Decrease the balance of the account.</a>
						</li>
					</ol>
				</li>
				<li>
					<a href="#non-functional-requirements">Non-functional requirements</a>
				</li>
				<li>
					<a href="#improvements">Improvements</a>
				</li>
			</ol>
		</div>
		<hr/>
		<div id="vocabulary" class="section">
			<h2>Vocabulary</h2>
			<table>
				<tr>
					<th>Short name</th>
					<th>Description</th>
				</tr>
				<tr>
					<td>iBBB</td>
					<td>Banana Best Bank Inc. application for which this documemtation has been created.</td>
				</tr>
				<tr>
					<td>&lt;userid&gt;</td>
					<td>The user identifier used in requests, eg. user with id <code>patryk</code> checks the account balance by sending the request <code>/balance/user/patryk</code>.</td>
				</tr>
				<tr>
					<td>client</td>
					<td>Banana Best Bank Inc.</td>
				</tr>
			</table>
		</div>
		<div id="introduction" class="section">
			<h2>Introduction</h2>
			Best Banana Bank Inc. needs an application that would calculate and store money balance for the user. The application should work as REST microservice.
		</div>
		<div id="functional-requirements" class="section">
			<h2>Functional requirements</h2>
			<p>
				Application iBBB should calculate and store money balance for the user. TheÂ user should be able to increase, decrease and check the balance on the account as well as check the list of transactions. Decreasing the balance corresponds to money withdrawal therefore it should be additionally protected by one time password (token) generated by the application. In order to decrease the balance in the first step one time password must be fetched and then it must be used in balance decrease request.
			</p>
			<h3>List of functional requirements</h3>
			<ol>
			
<!-- GENERATE ONE TIME PASSWORD/TOKEN -->		
				<h3><li id="generate-password">Generate the one time password.</li></h3>
				<h4>Description</h4>
				Operations increase, decrease, check balance, check history should be protected with one time password.
				
				<h4>Usage</h4>
				<table>
					<tr>
						<th>Request</th>
						<th>Sample response</th>
						<th>Description</th>
					</tr>
					<tr>
						<td>
<pre>
POST /tokens/user/&lt;userId&gt;
</pre>
						</td>
						<td>
<pre>
HTTP 201 Created

Content-Type: application/json

{ "token": "3a81de" }
</pre>
						</td>
						<td>
						Generates one time password that can be used to secure other operations.
						</td>
					</tr>
				</table>
						
				<h4>Possible responses</h4>
				<table>
				<tr>
					<th>Http response code</th>
					<th>Description</th>
				</tr>
				<tr>
					<td>201 Created</td>
					<td>Password generated with success.</td>
				</tr>
				</table>
				
				<h4>User cases</h4>
<div class="gherkin">
<span id="gherkin-feature"><span class="label">Feature</span>: <span class="description">One time password generation.</span></span>

	<span id="gherkin-scenario"><span class="label">Scenario</span>: <span class="description">User patryk want to generate one time password.</span></span>
		<span id="gherkin-step"><span class="label">When</span> <span class="description">user patryk generates password</span></span>
		<span id="gherkin-step"><span class="label">Then</span> <span class="description">response is returned</span>
		<b>| http response | content type     | content               |</b>
		| 200           | application/json | { "token": "2d3fa2" } |</span>
		</span>
		
		
</div>
				
<!-- CHECK THE ACCOUNT BALANCE -->		

				<h3><li id="check-the-balance">Check the balance of the account.</li></h3>
				<h4>Description</h4>
				User should be able to check the account balance.
				
				<h4>Usage</h4>
				<table>
					<tr>
						<th>Request</th>
						<th>Sample response</th>
						<th>Description</th>
					</tr>
					<tr>
						<td>
<pre>
GET /balance/user/&lt;userId&gt
</pre>
						</td>
						<td>
<pre>
HTTP 200 OK

Content-Type: application/json

{ "value": 400 }
</pre>
						</td>
						<td>Returns the current balance value for the specified user.</td>
					</tr>
				</table>
				<h4>Possible responses</h4>
				<table>
				<tr>
					<th>Http response code</th>
					<th>Description</th>
				</tr>
				<tr>
					<td>200 OK</td>
					<td>Account balance returned with success.</td>
				</tr>
				</table>
				<h4>User cases</h4>
<div class="gherkin">
<span id="gherkin-feature"><span class="label">Feature</span>: <span class="description">Account balance check.</span></span>

	<span id="gherkin-scenario"><span class="label">Scenario</span>: <span class="description">User patryk has no money on the account and want to check it</span></span>
		<span id="gherkin-step"><span class="label">Given</span> <span class="description">$0 on the account</span></span>
		<span id="gherkin-step"><span class="label">When</span> <span class="description">user patryk checks the account balance</span></span>
		<span id="gherkin-step"><span class="label">Then</span> <span class="description">user is informed that there is no money on the account</span>
		<b>| http response | content type     | content        |</b>
		| 200           | application/json | { "value": 0 } |</span>
		
	<span id="gherkin-scenario"><span class="label">Scenario</span>: <span class="description">User janusz has $10 on the account</span></span>
		<span id="gherkin-step"><span class="label">Given</span> <span class="description">$10 on the account</span></span>
		<span id="gherkin-step"><span class="label">When</span> <span class="description">user janusz checks the account balance</span></span>
		<span id="gherkin-step"><span class="label">Then</span> <span class="description">user is informed that he has $10 on the account</span>
		<b>| http response | content type     | content         |</b>
		| 200           | application/json | { "value": 10 } |</span>

</div>

<!-- CHECK THE LIST OF TRANSACTIONS -->

				<h3><li id="check-the-transactions">Check the list of transations.</li></h3>
				<h4>Description</h4>
				User should be able to check the history of transactions. History returned by response should be ordered by date.
				<h4>Usage</h4>
				<table>
					<tr>
						<th>Request</th>
						<th>Sample response</th>
						<th>Description</th>
					</tr>
					<tr>
						<td>
<pre>
GET /history/user/&lt;userId&gt;
</pre>
</td>
						<td>
<pre>
HTTP 200 OK

Content-Type: application/json

{ "transactions": [
    { 
      "type":"increase",
      "value":600
    },
    { 
      "type":"increase",
      "value":300
    },
    { 
      "type":"decrease",
      "value":500
    }
  ]
}
</pre>
						</td>
						<td>
						Returns the history of the transactions. The array is ordered from the first transaction.
						</td>
					</tr>
				</table>
				
				<h4>Possible responses</h4>
				<table>
				<tr>
					<th>Http response code</th>
					<th>Description</th>
				</tr>
				<tr>
					<td>200 OK</td>
					<td>History transactions returned with success.</td>
				</tr>
				</table>
				
				<h4>User cases</h4>
<div class="gherkin">
<span id="gherkin-feature"><span class="label">Feature</span>: <span class="description">Transaction history check.</span></span>

	<span id="gherkin-scenario"><span class="label">Scenario</span>: <span class="description">User patryk have not performed any transactions on his account.</span></span>
		<span id="gherkin-step"><span class="label">Given</span> <span class="description">no transactions done by user patryk</span></span>
		<span id="gherkin-step"><span class="label">When</span> <span class="description">user patryk checks the account transactions history</span></span>
		<span id="gherkin-step"><span class="label">Then</span> <span class="description">response with transactions history is returned</span>
		<b>| http response | content type     | content                |</b>
		| 200           | application/json | { "transactions": [] } |
		</span>
		
	<span id="gherkin-scenario"><span class="label">Scenario</span>: <span class="description">User bartosz have performed 3 increase and 2 decrease transactions on the account.</span></span>
		<span id="gherkin-step"><span class="label">Given</span> <span class="description">transactions done by user bartosz</span>
		<b>| type     | value |</b>
		| increase | 10    |
		| decrease | 5     |
		| increase | 5     |
		| increase | 5     |
		| decrease | 10    |</span>
		<span id="gherkin-step"><span class="label">When</span> <span class="description">user bartosz checks the account transactions history</span></span>
		<span id="gherkin-step"><span class="label">Then</span> <span class="description">response with transactions history is returned</span>
		<b>| http response | content type     | content                                 |</b>
		| 200           | application/json | { "transactions": [                     |
		|               |                  |       {"type":"increase", "value":10 }, |
		|               |                  |       {"type":"decrease", "value":5  }, |
		|               |                  |       {"type":"increase", "value":5  }, |
		|               |                  |       {"type":"increase", "value":5  }, |
		|               |                  |       {"type":"decrease", "value":10 }  |
		|               |                  |     ]                                   |
		|               |                  | }                                       |
		</span>
	
	<span id="gherkin-scenario"><span class="label">Scenario</span>: <span class="description">User anna have performed 2 increase and 2 decrease transactions on the account but one of the decrease operations was not allowed 
	          (user wanted to withdraw more money than it was available on the account).</span></span>
		<span id="gherkin-step"><span class="label">Given</span> <span class="description">transactions done by user anna</span>
		<b>| type     | value | description           |</b>
		| increase | 10    | allowed operation     |
		| increase | 10    | allowed operation     |
		| decrease | 25    | operation not allowed |
		| decrease | 20    | allowed operation     |</span>
		<span id="gherkin-step"><span class="label">When</span> <span class="description">user anna checks the account transactions history</span></span>
		<span id="gherkin-step"><span class="label">Then</span> <span class="description">response with transactions history is returned</span>
		<b>| http response | content type     | content                                  |</b>
		| 200           | application/json | { "transactions": [                      |
		|               |                  |       {"type":"increase", "value":10 },  |
		|               |                  |       {"type":"increase", "value":10  }, |
		|               |                  |       {"type":"decrease", "value":20  }, |
		|               |                  |     ]                                    |
		|               |                  | }                                        |
		</span>
		
</div>

<!-- INCREASE THE BALANCE OF THE ACCOUNT -->
				<h3><li id="increase-balance">Increase the balance of the account.</li></h3>
				<h4>Description</h4>
				User should be able to make a desposit on the account.
				
				<h4>Usage</h4>
				<table>
					<tr>
						<th>Request</th>
						<th>Sample response</th>
						<th>Description</th>
					</tr>
					<tr>
						<td>
<pre>
POST /balance/user/&lt;userId&gt;/increase

Headers:

Content-Type: application/json

Body:

{ 
  "value": 100,
  "token": "3a81de"
}
</pre>
						</td>
						<td>
						<pre>HTTP 200 OK</pre>
						</td>
						<td>Performs balance increase operation for the specified user.</td>
					</tr>
				</table>
						
				<h4>Possible responses</h4>
				<table>
				<tr>
					<th>Http response code</th>
					<th>Description</th>
				</tr>
				<tr>
					<td>200 OK</td>
					<td>Money deposited with success.</td>
				</tr>
				<tr>
					<td>401 Unauthorized</td>
					<td>User passed wrong password.</td>
				</tr>
				<tr>
					<td>400 Bad Request</td>
					<td>Request validation failed, eg. money can't be deposited because user sent request with negative value.</td>
				</tr>
				</table>
				
				<h4>User cases</h4>
				
<div class="gherkin">
<span id="gherkin-feature"><span class="label">Feature</span>: <span class="description">Account balance check.</span></span>

	<span id="gherkin-scenario"><span class="label">Scenario</span>: <span class="description">User patryk want to deposit $10 on the account.</span></span>
		<span id="gherkin-step"><span class="label">Given</span> <span class="description">$20 on the account</span>
		<span id="gherkin-step"><span class="label">When</span> <span class="description">user patryk deposits $10</span></span>
		<span id="gherkin-step"><span class="label">Then</span> <span class="description">response 200 is returned</span></span>
		<span id="gherkin-step"><span class="label">And</span> <span class="description">$30 is available on the account</span></span>
		
	<span id="gherkin-scenario"><span class="label">Scenario</span>: <span class="description">User patryk want to deposit -10 dollars on the account (negative number).</span></span>
		<span id="gherkin-step"><span class="label">Given</span> <span class="description">$20 on the account</span>
		<span id="gherkin-step"><span class="label">When</span> <span class="description">user patryk deposits -10 dollars</span></span>
		<span id="gherkin-step"><span class="label">Then</span> <span class="description">response 400 is returned</span></span>
		
	<span id="gherkin-scenario"><span class="label">Scenario</span>: <span class="description">User patryk want to deposit $10 dollars on the account but entered wrong password.</span></span>
		<span id="gherkin-step"><span class="label">Given</span> <span class="description">$20 on the account</span>
		<span id="gherkin-step"><span class="label">When</span> <span class="description">user patryk deposits 10 dollars</span></span>
		<span id="gherkin-step"><span class="label">And</span> <span class="description">user patryk entered wrong password</span></span>
		<span id="gherkin-step"><span class="label">Then</span> <span class="description">response 401 is returned</span></span>
</div>

<!-- DECREASE THE BALANCE OF THE ACCOUNT -->				
				<h3><li id="decrease-balance">Decrease the balance of the account.</li></h3>
				
				<h4>Description</h4>
				Decreasing the balance corresponds to money withdrawal therefore it should be additionally protected by one time password (token) generated by the application. In order to decrease the balance in the first step one time password must be fetched and then it must be used in balance decrease request.
				<h4>Usage</h4>
				<table>
					<tr>
						<th>Request</th>
						<th>Sample response</th>
						<th>Description</th>
					</tr>
					<tr>
						<td>
<pre>
POST /balance/user/&lt;userId&gt;/decrease

Headers:

Content-Type: application/json

Body:

{ 
  "value": 100,
  "token": "3a81de"
}
</pre>
						</td>
						<td>
<pre>
HTTP 200 OK
</pre>
						</td>
						<td>
						Performs balance decrease operation for the specified user. The operation is secured using one time password generated using the other endpoint.
						</td>
					</tr>
				</table>
				<h4>User cases</h4>
<div class="gherkin">
<span id="gherkin-feature"><span class="label">Feature</span>: <span class="description">Money withdrawal from the account</span></span>

	<span id="gherkin-scenario"><span class="label">Scenario</span>: <span class="description">User withdraws less money from the account than available.</span></span>
		<span id="gherkin-step"><span class="label">Given</span> <span class="description">$15 on the account</span></span>
		<span id="gherkin-step"><span class="label">When</span> <span class="description">user withdraws $5</span></span>
		<span id="gherkin-step"><span class="label">Then</span> <span class="description">Money has been withdrawn with success</span></span>
		<span id="gherkin-step"><span class="label">And</span> <span class="description">account balance is $10</span></span>
		
	<span id="gherkin-scenario"><span class="label">Scenario</span>: <span class="description">User withdraws more money from the account than available.</span></span>
		<span id="gherkin-step"><span class="label">Given</span> <span class="description">$15 on the account</span></span>
		<span id="gherkin-step"><span class="label">When</span> <span class="description">user withdraws $20</span></span>
		<span id="gherkin-step"><span class="label">Then</span> <span class="description">Money has not been withdrawn</span></span>
		<span id="gherkin-step"><span class="label">And</span> <span class="description">account balance is $15</span></span>
		
	<span id="gherkin-scenario"><span class="label">Scenario</span>: <span class="description">User withdraws the same amount of money from the account that available.</span></span>
		<span id="gherkin-step"><span class="label">Given</span> <span class="description">$15 on the account</span></span>
		<span id="gherkin-step"><span class="label">When</span> <span class="description">user withdraws $15</span></span>
		<span id="gherkin-step"><span class="label">Then</span> <span class="description">Money has been withdrawn with success</span></span>
		<span id="gherkin-step"><span class="label">And</span> <span class="description">account balance is $0</span></span>		
		
	<span id="gherkin-scenario"><span class="label">Scenario</span>: <span class="description">User needs to enter correct password to withdraw the money.</span></span>
		<span id="gherkin-step"><span class="label">Given</span> <span class="description">password 'pass1' to the account</span></span>
		<span id="gherkin-step"><span class="label">And</span> <span class="description">$15 on the account</span></span>
		<span id="gherkin-step"><span class="label">When</span> <span class="description">user withdraws $10</span></span>
		<span id="gherkin-step"><span class="label">And</span> <span class="description">enters password 'pass1'</span></span>
		<span id="gherkin-step"><span class="label">Then</span> <span class="description">money has been withdrawn with success</span></span>
		<span id="gherkin-step"><span class="label">And</span> <span class="description">account balance is $5</span></span>		
		
	<span id="gherkin-scenario"><span class="label">Scenario</span>: <span class="description">Money will not be withdrawn from the account if user entered wrong password.</span></span>
		<span id="gherkin-step"><span class="label">Given</span> <span class="description">password 'pass1' to the account</span></span>
		<span id="gherkin-step"><span class="label">And</span> <span class="description">$15 on the account</span></span>
		<span id="gherkin-step"><span class="label">When</span> <span class="description">user withdraws $10</span></span>
		<span id="gherkin-step"><span class="label">And</span> <span class="description">enters password 'pass1mistake'</span></span>
		<span id="gherkin-step"><span class="label">Then</span> <span class="description">money has not been withdrawn</span></span>
		<span id="gherkin-step"><span class="label">And</span> <span class="description">account balance is $15</span></span>
		
	<span id="gherkin-scenario"><span class="label">Scenario</span>: <span class="description">Money will not be withdrawn from the account if user entered negative number.</span></span>
		<span id="gherkin-step"><span class="label">And</span> <span class="description">$15 on the account</span></span>
		<span id="gherkin-step"><span class="label">When</span> <span class="description">user withdraws -10 dollars</span></span>
		<span id="gherkin-step"><span class="label">Then</span> <span class="description">response 400 is returned</span></span>
		<span id="gherkin-step"><span class="label">And</span> <span class="description">account balance is $15</span></span>
</div>
			</ol>
		</div>
		<div id="non-functional-requirements" class="section">
			<h2>Non-functional requirements</h2>
			As agreed with client non-functional requirements will be specified after first release of the project.
		</div>
		<div id="improvements" class="section">
			<h2>Improvements</h2>
			<ul>
				<li>User needs to enter password to deposit money to the account (security improvement).</li>
			<ul>
		</div>
		<div id="todo" class="section">
			<h2>TODO list</h2>
			<ul>
				<li>Security improvements.</li>
			<ul>
		</div>
	</body>
</html>